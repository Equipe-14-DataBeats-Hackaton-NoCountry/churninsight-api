# ==============================================================================
# ChurnInsight API - Configuration
# Version: 1.0.0
# Environment: Development (override via environment variables in production)
# ==============================================================================

# ------------------------------------------------------------------------------
# Server Configuration
# ------------------------------------------------------------------------------
server.port=${SERVER_PORT:10808}
server.tomcat.threads.max=80
server.tomcat.threads.min-spare=10
server.tomcat.accept-count=150
server.tomcat.keep-alive-timeout=30000
server.tomcat.max-keep-alive-requests=15000

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/churn_db?useSSL=false&allowPublicKeyRetrieval=true&rewriteBatchedStatements=true&cachePrepStmts=true&prepStmtCacheSize=250&useServerPrepStmts=true}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:123456}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP Connection Pool
spring.datasource.hikari.pool-name=ChurnInsightPool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=8
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.leak-detection-threshold=60000

# ------------------------------------------------------------------------------
# JPA/Hibernate Configuration
# ------------------------------------------------------------------------------
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=1500
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.jdbc.fetch_size=500
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# ------------------------------------------------------------------------------
# Flyway Database Migration
# ------------------------------------------------------------------------------
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false

# ------------------------------------------------------------------------------
# Virtual Threads (Java 21+)
# ------------------------------------------------------------------------------
spring.threads.virtual.enabled=true

# ------------------------------------------------------------------------------
# Jackson Serialization
# ------------------------------------------------------------------------------
spring.jackson.property-naming-strategy=SNAKE_CASE
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# ------------------------------------------------------------------------------
# File Upload
# ------------------------------------------------------------------------------
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=200MB
spring.servlet.multipart.file-size-threshold=2KB

# ------------------------------------------------------------------------------
# Actuator & Monitoring
# ------------------------------------------------------------------------------
management.endpoints.web.exposure.include=health,prometheus,metrics,info
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.metrics.tags.application=churn-api
management.info.env.enabled=true

# ------------------------------------------------------------------------------
# Security
# ------------------------------------------------------------------------------
spring.security.user.name=${SECURITY_USER:admin}
spring.security.user.password=${SECURITY_PASSWORD:Admin123}
spring.security.user.roles=${SECURITY_ROLES:ADMIN}

# ------------------------------------------------------------------------------
# CORS
# ------------------------------------------------------------------------------
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://127.0.0.1:3000,http://churn-frontend:3000,http://localhost:8080}

# ------------------------------------------------------------------------------
# Application Cache
# ------------------------------------------------------------------------------
app.cache.ttl-minutes=30
app.cache.max-size=50000

# ------------------------------------------------------------------------------
# Batch Processing
# ------------------------------------------------------------------------------
app.batch.core-pool-size=6
app.batch.max-pool-size=10
app.batch.size=2500
app.batch.inference-threads=10

# ------------------------------------------------------------------------------
# Database Insert Optimization
# ------------------------------------------------------------------------------
app.db.insert-threads=10
app.db.chunk-size=1500

# ------------------------------------------------------------------------------
# Rate Limiting
# ------------------------------------------------------------------------------
app.rate-limit.requests-per-second=50
app.rate-limit.burst-capacity=100