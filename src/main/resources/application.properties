# ==============================================================================
# ChurnInsight API - Configuration
# Version: 1.0.0
# Environment: Production (override via environment variables)
# ==============================================================================

# ------------------------------------------------------------------------------
# Spring Core Configuration
# ------------------------------------------------------------------------------
spring.main.allow-bean-definition-overriding=true

# ------------------------------------------------------------------------------
# Server Configuration
# ------------------------------------------------------------------------------
server.port=${SERVER_PORT:10808}
server.tomcat.threads.max=80
server.tomcat.threads.min-spare=10
server.tomcat.accept-count=150
server.tomcat.keep-alive-timeout=30000
server.tomcat.max-keep-alive-requests=15000
server.tomcat.max-swallow-size=-1
spring.jmx.enabled=false
spring.application.admin.enabled=false

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP Connection Pool
spring.datasource.hikari.pool-name=ChurnInsightPool
spring.datasource.hikari.maximum-pool-size=40
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.leak-detection-threshold=60000

# ------------------------------------------------------------------------------
# JPA/Hibernate Configuration
# ------------------------------------------------------------------------------
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=5000
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.jdbc.fetch_size=1000
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# ------------------------------------------------------------------------------
# Flyway - Database Migrations
# ------------------------------------------------------------------------------
spring.flyway.enabled=true
spring.flyway.clean-disabled=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false
spring.flyway.baseline-on-migrate=true

# ------------------------------------------------------------------------------
# Virtual Threads (Java 21+)
# ------------------------------------------------------------------------------
spring.threads.virtual.enabled=true

# ------------------------------------------------------------------------------
# Jackson Serialization
# ------------------------------------------------------------------------------
spring.jackson.property-naming-strategy=SNAKE_CASE
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# ------------------------------------------------------------------------------
# File Upload
# ------------------------------------------------------------------------------
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=200MB
spring.servlet.multipart.file-size-threshold=2KB

# ------------------------------------------------------------------------------
# Actuator and Monitoring
# ------------------------------------------------------------------------------
management.endpoints.web.exposure.include=health,prometheus,metrics,info
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.metrics.tags.application=churn-api
management.info.env.enabled=true

# ------------------------------------------------------------------------------
# Security
# Note: In production, use environment variables. Never commit real passwords.
# ------------------------------------------------------------------------------
spring.security.user.name=${SECURITY_USER}
spring.security.user.password=${SECURITY_PASSWORD}
spring.security.user.roles=${SECURITY_ROLES}

# ------------------------------------------------------------------------------
# CORS
# ------------------------------------------------------------------------------
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS}

# ------------------------------------------------------------------------------
# Application Cache
# ------------------------------------------------------------------------------
app.cache.ttl-minutes=30
app.cache.max-size=50000

# ------------------------------------------------------------------------------
# Batch Processing
# ------------------------------------------------------------------------------
app.batch.core-pool-size=12
app.batch.max-pool-size=24
app.batch.size=10000
app.batch.inference-threads=10
app.batch.max-records=100000

# ------------------------------------------------------------------------------
# Database Insert Optimization
# ------------------------------------------------------------------------------
app.db.insert-threads=24
app.db.chunk-size=5000

# ------------------------------------------------------------------------------
# Rate Limiting
# ------------------------------------------------------------------------------
app.rate-limit.requests-per-second=50
app.rate-limit.burst-capacity=100

# ------------------------------------------------------------------------------
# Public base URL for the API (used by Swagger/OpenAPI).
# Required when the application runs in a container with an internal port different from the exposed host port.
app.public-base-url=${APP_PUBLIC_BASE_URL:http://localhost:10808}